- hosts: localhost
  gather_facts: no
  connection: local
  vars:
  - auto_commit: True
  - manageiq_validate_certs: False
  - templates: []
  roles:
  - syncrou.manageiq-automate
  tasks:
    - name: Gather only registered virtual machine templates
      vmware_vm_facts:
        hostname: vcenter-aa11.rhpds.opentlc.com
        username: root
        password: r3dh4t1!
        vm_type: template
        validate_certs: false
      delegate_to: localhost
      register: template_facts

    - name: print gather_facts
      debug:
       msg: "{{template_facts.virtual_machines.keys()}}"

    - name: print workspace
      debug:
        msg: "{{workspace}}"

    - name: create templates lists
      set_fact:
        templates: "{{templates + [{item: item}]}}"
      with_items: "{{template_facts.virtual_machines.keys()}}"

    - name: "Set a State Var"
      manageiq_automate:
        workspace: "{{ workspace }}"
        set_state_var:
          attribute: "dropdown_list_1_1"
          value: "{{templates}}"
      register: workspace
